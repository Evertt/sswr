"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; }var _swrev = require('swrev');var _store = require('svelte/store');var c=class extends _swrev.DefaultCache{constructor(){super();if(typeof window!="undefined"){for(let e=0;e<window.sessionStorage.length;e++){let s=window.sessionStorage.key(e),t=s.replace(/^sswr-/,"");if(s===t)continue;let r=window.sessionStorage.getItem(s),i=JSON.parse(r);this.elements.set(t,new (0, _swrev.CacheItem)({data:i.data,expiresAt:i.expiresAt?new Date(i.expiresAt):null}))}setInterval(()=>this.purge(),15e3)}}purge(){for(let e=0;e<window.sessionStorage.length;e++){let s=window.sessionStorage.key(e),t=s.replace(/^sswr-/,"");if(s===t)continue;let r=window.sessionStorage.getItem(s),i=JSON.parse(r);new Date(i.expiresAt||0).getTime()>=new Date().getTime()||this.remove(t,{broadcast:!1})}}remove(e,s){super.remove(e,s),typeof window!="undefined"&&window.sessionStorage.removeItem(`sswr-${e}`)}resolve(e,s){Promise.resolve(s.data).then(t=>{if(t==null)return this.remove(e);s.data=t,typeof window!="undefined"&&window.sessionStorage.setItem(`sswr-${e}`,JSON.stringify(s)),this.broadcast(e,t)})}};var d=class extends _swrev.SWR{useSvelte(e,s){let t=()=>{},r=_store.writable.call(void 0, this.get(this.resolveKey(e)),()=>()=>t()),i=_store.writable.call(void 0, void 0,()=>()=>t()),p=n=>r.set(n),S=n=>i.set(n);return t=this.use(e,p,S,s).unsubscribe,r.then=n=>new Promise(l=>{let m,u=()=>{};u=r.subscribe(a=>{if(a!==void 0){u(),m=a;let f=_optionalChain([n, 'optionalCall', _ => _(a)]);l(f||a)}}),m&&u()}),{data:r,error:i,mutate:(n,l)=>this.mutate(this.resolveKey(e),n,l),revalidate:n=>this.revalidate(this.resolveKey(e),n),clear:n=>this.clear(this.resolveKey(e),n),unsubscribe:t,then:n=>{r.then(n).then(()=>t())}}}},R= exports.createSWR =(o={})=>{let e=new d({cache:new c,...o});return{useSWR:(s,t)=>e.useSvelte(s,t),mutate:(s,t,r)=>e.mutate(s,t,r),revalidate:(s,t)=>e.revalidate(s,t),clear:(s,t)=>e.clear(s,t)}};exports.SSWR = d; exports.createSWR = R;
