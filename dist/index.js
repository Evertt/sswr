"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; }var _swrev = require('swrev');var _store = require('svelte/store');var d=class extends _swrev.DefaultCache{constructor(){super();if(typeof window!="undefined"){for(let e=0;e<window.sessionStorage.length;e++){let s=window.sessionStorage.key(e),t=s.replace(/^sswr-/,"");if(s===t)continue;let i=window.sessionStorage.getItem(s),r=JSON.parse(i);this.elements.set(t,new (0, _swrev.CacheItem)({data:r.data,expiresAt:r.expiresAt?new Date(r.expiresAt):null}))}setInterval(()=>this.purge(),15e3)}}purge(){console.log("purging...");for(let e=0;e<window.sessionStorage.length;e++){let s=window.sessionStorage.key(e),t=s.replace(/^sswr-/,"");if(s===t)continue;let i=window.sessionStorage.getItem(s),r=JSON.parse(i);if(!r.expiresAt)continue;let l=new Date(r.expiresAt);console.log("Found item to purge"),!(l.getTime()>=new Date().getTime())&&(console.log("purging item..."),this.remove(t,{broadcast:!1}))}}remove(e,s){super.remove(e,s),typeof window!="undefined"&&window.sessionStorage.removeItem(`sswr-${e}`)}resolve(e,s){Promise.resolve(s.data).then(t=>{if(t==null)return this.remove(e);s.data=t,typeof window!="undefined"&&window.sessionStorage.setItem(`sswr-${e}`,JSON.stringify(s)),this.broadcast(e,t)})}};var p=class extends _swrev.SWR{useSvelte(e,s){let t=()=>{},i=_store.writable.call(void 0, this.get(this.resolveKey(e)),()=>()=>t()),r=_store.writable.call(void 0, void 0,()=>()=>t()),l=n=>i.set(n),S=n=>r.set(n);return t=this.use(e,l,S,s).unsubscribe,i.then=n=>new Promise(u=>{let m,c=()=>{};c=i.subscribe(o=>{if(o!==void 0){c(),m=o;let f=_optionalChain([n, 'optionalCall', _ => _(o)]);u(f||o)}}),m&&c()}),{data:i,error:r,mutate:(n,u)=>this.mutate(this.resolveKey(e),n,u),revalidate:n=>this.revalidate(this.resolveKey(e),n),clear:n=>this.clear(this.resolveKey(e),n),unsubscribe:t,then:n=>{i.then(n).then(()=>t())}}}},D= exports.createSWR =(a={})=>{let e=new p({cache:new d,...a});return{useSWR:(s,t)=>e.useSvelte(s,t),mutate:(s,t,i)=>e.mutate(s,t,i),revalidate:(s,t)=>e.revalidate(s,t),clear:(s,t)=>e.clear(s,t)}};exports.SSWR = p; exports.createSWR = D;
