import{SWR as v}from"swrev";import{writable as w}from"svelte/store";import{CacheItem as g,DefaultCache as h}from"swrev";var d=class extends h{constructor(){super();if(typeof window!="undefined"){for(let e=0;e<window.sessionStorage.length;e++){let s=window.sessionStorage.key(e),t=s.replace(/^sswr-/,"");if(s===t)continue;let i=window.sessionStorage.getItem(s),r=JSON.parse(i);this.elements.set(t,new g({data:r.data,expiresAt:r.expiresAt?new Date(r.expiresAt):null}))}setInterval(()=>this.purge(),15e3)}}purge(){console.log("purging...");for(let e=0;e<window.sessionStorage.length;e++){let s=window.sessionStorage.key(e),t=s.replace(/^sswr-/,"");if(s===t)continue;let i=window.sessionStorage.getItem(s),r=JSON.parse(i);if(!r.expiresAt)continue;let l=new Date(r.expiresAt);console.log("Found item to purge"),!(l.getTime()>=new Date().getTime())&&(console.log("purging item..."),this.remove(t,{broadcast:!1}))}}remove(e,s){super.remove(e,s),typeof window!="undefined"&&window.sessionStorage.removeItem(`sswr-${e}`)}resolve(e,s){Promise.resolve(s.data).then(t=>{if(t==null)return this.remove(e);s.data=t,typeof window!="undefined"&&window.sessionStorage.setItem(`sswr-${e}`,JSON.stringify(s)),this.broadcast(e,t)})}};var p=class extends v{useSvelte(e,s){let t=()=>{},i=w(this.get(this.resolveKey(e)),()=>()=>t()),r=w(void 0,()=>()=>t()),l=n=>i.set(n),S=n=>r.set(n);return t=this.use(e,l,S,s).unsubscribe,i.then=n=>new Promise(u=>{let m,c=()=>{};c=i.subscribe(o=>{if(o!==void 0){c(),m=o;let f=n?.(o);u(f||o)}}),m&&c()}),{data:i,error:r,mutate:(n,u)=>this.mutate(this.resolveKey(e),n,u),revalidate:n=>this.revalidate(this.resolveKey(e),n),clear:n=>this.clear(this.resolveKey(e),n),unsubscribe:t,then:n=>{i.then(n).then(()=>t())}}}},D=(a={})=>{let e=new p({cache:new d,...a});return{useSWR:(s,t)=>e.useSvelte(s,t),mutate:(s,t,i)=>e.mutate(s,t,i),revalidate:(s,t)=>e.revalidate(s,t),clear:(s,t)=>e.clear(s,t)}};export{p as SSWR,D as createSWR};
