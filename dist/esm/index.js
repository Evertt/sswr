import{SWR as W}from"swrev";import{writable as f}from"svelte/store";import{CacheItem as D,DefaultCache as R}from"swrev";var a="sswr-",p=class extends R{constructor(){super();let e=this.storage();if(!!e){for(let s=0;s<e.length;s++){let t=e.key(s);if(t.slice(0,a.length)!==a)continue;let o=t.slice(a.length),c=e.getItem(t),i=JSON.parse(c);this.elements.set(o,new D({data:i.data,expiresAt:i.expiresAt?new Date(i.expiresAt):null}))}setInterval(()=>this.purge(),15e3)}}storage(){return typeof window!="undefined"&&"sessionStorage"in window&&window.sessionStorage||null}purge(){this.elements.forEach((e,s)=>{e.hasExpired()&&this.remove(s,{broadcast:!1})})}remove(e,s){super.remove(e,s),this.storage()?.removeItem(a+e)}resolve(e,s){Promise.resolve(s.data).then(t=>{if(t==null)return this.remove(e);s.data=t,this.storage()?.setItem(a+e,JSON.stringify(s)),this.broadcast(e,t)})}};var m=class extends W{useSvelte(e,s){let t=()=>{},n=f(this.get(this.resolveKey(e)),()=>()=>t()),o=f(void 0,()=>()=>t()),c=r=>n.set(r),i=r=>o.set(r);return t=this.use(e,c,i,s).unsubscribe,n.then=r=>new Promise(d=>{let v,h=()=>{};h=n.subscribe(l=>{if(l!==void 0){h(),v=l;let S=r?.(l);d(S||l)}}),v&&h()}),{data:n,error:o,mutate:(r,d)=>this.mutate(this.resolveKey(e),r,d),revalidate:r=>this.revalidate(this.resolveKey(e),r),clear:r=>this.clear(this.resolveKey(e),r),unsubscribe:t,then:r=>{n.then(r).then(()=>t())}}}},g=(u={})=>{let e=new m({cache:new p,...u});return{useSWR:(s,t)=>e.useSvelte(s,t),mutate:(s,t,n)=>e.mutate(s,t,n),revalidate:(s,t)=>e.revalidate(s,t),clear:(s,t)=>e.clear(s,t)}};export{m as SSWR,g as createSWR};
